# 11장 CQRS

### 11.1단일 모델의 단점

- 조회 기능 구현 시 여러 애그리거트에서 데이터를 가져와야함. 즉시로딩과 같은 방식으로 한번에 데이터를 읽어올 수 없으면 성능에 문제 발생
- 애그리거트간 연관을 식별자가 아닌 직접참조 시에도 연관에대해 즉시로딩/지연로딩
- 문제 발생이유 : 조회&상태 변경에 단일 도메인 모델 사용 (ORM은 상태변경에는 적합하나 조회에는 복잡함)

### 11.2CQRS

- 시스템은 크게 상태변경 / 상태정보 조회 두가지 기능으로 나눌 수 있음
- 상태변경 범위와 상태조회 범위가 정확하게 일치하지 않기때문에 단일 모델로 구현시 복잡해져서 이를 해결하기 위해 CQRS (Command Query Responsibility Segregation)사용
- 복잡한 도메인에 적합하다. 복잡할수록 범위에 차이가 나기 때문
- 각 모델에 맞는 구현 기술, 데이터베이스 선택 가능 - 예시 : 조회 mybatis(SQL),NoSQL/ 명령 JPA,RDBMS
- 조회 모델에는 응용로직이 복잡하지 않아 응용서비스 없이 컨트롤러에서 바로 DAO를 사용해도 무방하다
- 명령 모델은 객체를 기반으로한 도메인 모델 이용/ 조회 모델은 테이터 타입 이용
- 다른 DB를 사용하는 경우 데이터 동기화 시점에 따라 구현 방식 상이 ( 즉시 →동기이벤트, 글로벌트랜잭션(성능저하) / 특정시간안에 → 비동기(성능 보호) )

### 11.2.1 웹과 CQRS

- 웹은 상태 변경보다 조회 요청이 많다 ( 쇼핑몰: 주문 요청<상품조회, 게시판: 게시글등록<조회)
- 쿼리 최적화로 실행속도 높이기/ 메모리에 조회 데이터 캐싱하여 응답속도 높이기/ 조회 전용 저장소 등 조회 성능을 높이기 위한 기법들 도입
- 결과적으로 CQRS를 도입하는것과 같은 효과 ← 캐싱 데이터는 조회전용모델을 캐싱, 최적화도 화면에 보여줄 데이터 기반 쿼리 작성

### 11.2.1 CQRS 장단점

- 장점
    - 명령 모델 구현시 도메인 자체에 집중 가능
    - 명령모델에 조회 관련 로직이 사라져 복잡도가 낮아짐
    - 조회 성능을 향상시키는데 유리 (캐시/쿼리최적화/저장소 등, 명령모델에 영향 X)
- 단점
    - 구현 비용 및 유지보수 비용
    - 더 많은 구현 기술 필요 ( 메세징 시스템, 저장소 등)
- 도메인이 복잡한경우에 권장

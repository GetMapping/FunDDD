# 9장 도메인 모델과 바운디드 컨텍스트

## 9.1 도메인 모델과 경계

- 도메인을 완벽하게 표현하는 단일 모델을 만들기는 어려움. 한 도메인은 여러 하위 도메인으로 구분됨
- 하위도메인마다 같은 용어라도 의미가 다르고, 같은 대상이여도 용어가 다를 수 있음
- 올바른 도메인 모델 개발을 위해서는 하위 도메인마다 모델을 만들어야함. 명시적인 구분 경계를 가져서 섞이지 않게 해야함.
- 모델은 특정한 컨텍스트(문맥) 하에서 완전한 의미를 가진다, 따라서 이렇게 구분되는 경계를 갖는 컨텐스트를 **바운디드 컨텍스트**라고 한다. (ex -  카탈로그 컨텍스트, 재고 커텍스트에서의 제품)

## 9.2 바운디드 컨텍스트

- 바운디드 컨텍스트는 모델의 경계를 결정, 한개의 바운디드 컨텐스트는 논리적으로 한개의 모델을 가짐
- 용어를 기준으로 컨텍스트를 분리, 사용자에게 기능을 제공하는 물리적 시스템으로 컨텍스트 안에서 도메인을 구현
- 하위도메인과 컨텍스트는 일대일이 이상적이나 대부분그렇지 않음( 개발 분업에 따라 결정)
    - 주문과 결제금액이 주문의 하위 도메인이 됨
    - 용어 구분이 덜 되어 카탈로그와 재고 관리 두 하위 도메인이 하나의 컨텍스트가 됨
    - 서비스 단위가 되어 여러 하위도메인이 한개의 컨텍스트가됨
- 여러 도메인을 하나의 바운디드 컨텍스트에서 개발할 때 단일 모델로 합치지 않도록 주의!
    
    

## 9.3 바운디드 컨텍스트 구현

- 바운디드 컨텍스트는 모데인 모델 뿐만아니라 표현 영역, 응용서비스, 인프라스트럭처 영역을 모두포함.(+ DB 테이블 스카미까지)- 바운디드컨텍스트 = 도메인 기능을 제공하는데 필요한 모든 요소 포함
- 표현 영역 → html, rest api 등등.. UI서버를 둘 수도 있음( 각 바운디드 컨텍스트를 위한 파사드 역할 수행)
- 복잡한 도메인 로직이 없을경우 단순 DAO와 CRUD ,서비스-DAO 구조가 되면 도메인 기능이 서비스에 흩어지게 되지만 단순할경우 문제 X
    
    
- 한 바운디드 컨텍스트 내에서 두방식을 혼합해서 사용할 수 도 있음 , CQRS가 대표적인 예, 상태변경은 도메인 모델기반, 조회기능은 서비스-dao 기반

## 9.4 바운디드 컨텍스트간 통합

- 새로운 기능 추가 시 바운디드 컨텍스트간 통합이 이루어 질 수 있다.
- 직접 통합 -rest api 호출
    - 카탈로그와 추천시스템의 경우, 카탈로그 도메인과 일치하지 않는 데이터를 제공하기 때문에 데이터를 읽어와 도메인에 맞는 상품모델로 변환, 변환과정이 복잡하면 별도 클래스생성
- 간접 통합 - 메세지 큐
    - 활동 이력같은경우를 전달할때 사용, 카탈로그 바운디드컨테그트가 비동기로 활동이력을 큐에 추가하고, 추천 바운디듣 컨텍스트가 이력메세지를 읽어와 계산 시 사용. ( 데이터 구조를 맞춰야함, 어느 도메인이 변환할지는 도메인 기준에 따라 다름)
- MSA는 바운디드 컨텍스트와 잘 어울림. 바운디드 컨텍스트별로 마이크로 서비스를 구현하면 자연스럽게 컨텍스트별로 모델이 분리

## 9.5 바운디드 컨텍스트간 관계

- 컨텍스트간 API 호출( 하류← 상류 , 고객/공급자 관계)
- 하류컴포넌트는 상류 데이터와 기능에 의존
- 상류 컴포넌트는 통신 프로토콜을 정의하고 공개한다, 서비스 형태로 제공하는 경우 이런 서비스를 **공개 호스트 서비스(open host service**)라고 한다
    - 각 서비스별로 검색기능을 구현하기 보다는 전용 시스템 구축
    
     
    - 상류 컴포넌트의 서비스느 ㄴ상류 바운디드 컨텍스트의 도메인 모델을 따르기 떄문에 하류 컴포넌트는 상류가 도메인 모델에 영향을 주지않도록 완충지대를 만들어야한다 (인프라 계층의 RecSystem Client가 외부시스템과의 연동을 처리하여 모델이 깨지는 것을 막아주는 **안티코럽션 계층**이 된다) Anticorruption Layer
        
         
    
- 두 바운디드 컨텍스트가 같은 모델을 공유하는 경우, 해당 모델을 **공유커널**(SHARED KERNEL)이라고 부른다, 동일한 모델을 두번 개발하는 중복을 줄이지만 긴밀한 소통이 필요
- 독립방식은 서로 통합하지 않는 방식. (수동으로 입력) , 수동에는 한계가 있으므로 규모가 작은경우에만 가능, 독립방식으로 개발한 두 바운디드 컨텍스트르 ㄹ통합하기위해 별도의 시스템을 만들어야할 수 도 있음

## 9.6 컨텍스트 맵

- 바운디드 컨텍스트간의 관계를 표시한 것
- 오픈호스트(OHS) 서비스, 안티코럽션 계층(ACL)등을 표시한다

# 2장 아키텍처 개요

### 2.1 네개의 영역

- Presentation계층(사용자,인터페이스,표현 계층) : 사용자(외부시스템)의 요청을 처리하고 정보를 보여줌
- Application계층(응용계층) : 요청한 기능을 실행, 로직을 직접 구현하지 않으며 도메인 계층을 조합하여 기능 실핼
- Domain : 시스템이 제공할 도메인 규칙 구현(비즈니스 로직?)
- infrastructure : 데이터베이스나 메시징시스템같은 외부 시스템과의 연동

위와같은 부분은 아키텍처 설계의 전형적인 영역

- 웹 서비스에서 표현 영역은 http요청을 응용 영역 필요로 하는 형식으로 변환하여 전달하고, 응용영역의 응답을 http 응답으로 변환하여 전송

![image](https://github.com/GetMapping/FunDDD/assets/26589901/66cc4595-93cb-44e6-b51d-a1684407992f)
- 응용 역역은 기능을 구현하기 위해 도메인 영역의 도메인 모델을 사용, 응용 서비스는 로직을 직접 수행하기 보다는 도메인 모델에 로직 수행을 위임

![image](https://github.com/GetMapping/FunDDD/assets/26589901/d4a78f59-ce2e-44ba-87ed-7f4ab51be9ab)
- 도메인 영역은 도메인 모델을 구현, 도메인 모델은 도메인의 핵심 로직을 구현
- 인프라스트럭처 영역은 구현 기술에 대해 다룸, 데이터 베이스 연동이나 메시지 큐에 메시지 전달, 그 외에도 smtp를 이용한 메일 전달이나 api호출도 포함된다. 개념보단 실제 구현을 다루는 영역

![image](https://github.com/GetMapping/FunDDD/assets/26589901/8db77b8a-341c-4b64-9322-15da1c197d66)
- 도메인,응용,표현 영역은 코드를 직접 만들지 않고 인프라 영역에서 제공하는 기능을 사용하여 기능을 개발

### 2.2 계층 구조 아키텍처

- 계층 구조는 특성상 상위 계층에서 하위 계층으로의 의존만 존재.
- 바로 아래 계층에만 의존을 가져야 하지만 구현의 편리함을 위해 인프라계층과도 의존하기도 함
- 표현,응용,도메인 계층이 인프라스트럭처에 종속되게 됨
    
    → 테스트, 기능확장이 어려움
    

### 2.3 DIP

- dependency inversion principle : 의존 역전 원칙, 저수준이 고수준에 의존한다
- 고수준 모듈은 의미있는 다일 기능을 제공하는 모듈, 여러 하위 기능을 구현한 것은 저수준 모듈
- 인프라스트럭처에 종속적인 문제를 해결하기 위해 DIP를 통해 저수준모듈이 고수준모듈에 의존하도록함
    - 저수준 모듈을 추상화하여 의존역전이 일어나도록 함

![image](https://github.com/GetMapping/FunDDD/assets/26589901/556e349d-6282-4cea-8fa5-a16987726e0d)
- 구현 객체 생성 코드를 변경함으로서 기능확장(교체)에 대한 문제 해결
- 대역 객체를 통해 테스트 가능
- 하위기능을 추상화한 인터페이스는 고수준 모듈 관점에서 도출한다 (도메인/인프라)
- DIP를 이용하면 계층형 구조와는 달리 인프라가 도메인과 응용계층을 의존하는 구조가 됨 ( 영향 최소화)

### 2.4 도메인 영역의 구성 요소

- 도메인 영역 : 도메인 핵심 모델 규현, 도메인 영역의 모델은 도메인의 주요 개념을 표현하며 핵심 로직 을 구현한다.
- 구성요소 4가지
    - 엔티티 : 고유의 식별자를 갖는 객체로 자신의 라이프 사이클을 가짐.도메인의 고유한 개념 표현, 도메인 모델의 데이터를 포함하며 해당 데이터와 관련된 기능을 함께 제공
    - 밸류 : 고유의 식별자를 가지지 않고 개념적으로 하나인 값을 표현할 때 사용. 엔티티의 속성으로 사용 될 뿐만 아니라 다른 밸류타입의 속성으로도 사용 할 수 있다
    - 애그리거트 : 연관된 엔티티와 밸류를 개념저긍로 하나로 묶은 것
    - 리포지터리 : 도메인 모델의 영속성 처리
    - 도메인 서비스 : 특정 엔티티에 속하지 않는 도메인 로직 제공
- 실제 도메인 모델의 엔티티와 rdb 모델의 엔티티는 같은 것이 아님 , 단순 데이터 구조라기 보다는 데이터와 함께 기능을 제공
    - 도메인 관점에서 기능을 구현하고 , 기능구현을 캡슐화하여 데이터가 임의로 변경되는것을 막음
    - 두개 이상의 데이터가 개념적으로 하나인 경우 밸류 타입을 이용해서 표현 가능 → 불변으로!(교체)
- 도메일 모델이 커지면서 상위 수준에서 모델을 관리하지 못하고 개별요소의 엔티티와 밸류에 집중하게 될 수  있음, 상위 수준에서 모델을 보며 도메인 모델에서 전체 구조를 이해하는데 도움이 되는것이 애그리거트
    - 관련 객체를 묶어서 객체 군집 단위로 모델을 바라보고 애그리거트 간의 관계로 도메인 모델 이해
    - 루트 엔티티는 속해있는 엔티티티와 밸류 객체를 이용하여 애그리거트가 구현해야할 기능 제공
- 리포지터리는 애그리거트 단위로 도메인 객체를 저장하고 조회.(영속성)
    - 도메인 객체를 rdbms등과 같은 물리적인 저장소에 저장
    - 엔티티나 밸류가 요구사항에서 도출되는 도메인 모델이라면 , 리포지터리는 구현을 위한 도메인 모델
    - 리포지터리를 추상화한것은 고수준 모듈, 리포지터리 구현 글래스는 저수준으로 인프라스트럭처 계층
        
        → 응용서비스는 의존 주입과 같은 방식을 사용해 리포지터리 구현 객체에 접근한다( 도메인 객체를 구하거나 저장할때 사용, 트랜잭션 관리시 리포지터리 구현 기술에 영향받음)
        
        → 리포지터리는 애그리거트 저장하는 메소드와 루트식별자로 조회하는 메서드를 제공
        

### 2.5 요청처리 흐름

- 표현 영역이 요청을 처음 받아 처리(컨트롤러), 표현 영역은 데이터 형식을 검사한뒤 변환하여 응용 서비스에 기능 실행 위임
- 응용서비스는 도메인 모델을 이용하여 기능 구현(리포지터리 사용)

![image](https://github.com/GetMapping/FunDDD/assets/26589901/164d3a55-f802-4833-a27f-9204983f95f9)

### 2.6 인프라스트럭처 개요

- 인프라 스트럭처는 표현,응용,도메인 계층을 지원
    - DIP로 인프라스트럭처의 기능을 직접 사용하는 것보다 인터페이스를 구현하는 방식이 유연하고 테스트하기 용이
    - @transational,@Entitiy과 같이 구현의 편리함을 위해 인프라 스트럭처를 의존하여 사용하기도 함

### 2.7 모듈구성

- 아키텍처의 각 영역은 별도 패키지에 위치
- 도메인이 크면 하위 도메인으로 나눠 별도 패키지로 구성
- 도메인 모듈은 도메인에 속한 애그리거트를 기준으로 다시 패키지를 구성
- 애그리거트,모델,리포지터리는 같은 패키지에 위치시킨다
